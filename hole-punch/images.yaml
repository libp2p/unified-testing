# Hole Punch Interop - Implementation Definitions
# This file defines all implementations to test for hole punching interoperability

# Test Aliases - Define reusable patterns for test selection
# Usage: --test-select "~linux" or --test-ignore "!~linux"
test-aliases:
  - alias: "all"
    value: "~rust|~go|~js"
  - alias: "rust"
    value: "rust-v0.56"
  - alias: "go"
    value: "go-v0.45"
  - alias: "js"
    value: "js-v3.x"
  - alias: "failing"
    value: "rust-v0.56 x rust-v0.56"

# Router configurations - Multiple router types for testing different NAT implementations
routers:
  - id: linux
    source:
      type: local
      path: images/linux
      dockerfile: Dockerfile

# Relay configurations - Multiple relay types for testing different implementations
relays:
  - id: rust-v0.56
    source:
      type: local
      path: images/rust/v0.56
      dockerfile: Dockerfile.relay
    transports: [quic-v1, tcp, webrtc-direct, ws]
    secureChannels: [noise, tls]
    muxers: [yamux, mplex]

  # Go implements Circuit Relay v2 — the gold standard for DCUtR per the docs
  - id: go-v0.45
    source:
      type: github
      repo: libp2p/go-libp2p
      commit: d0ecbf99a977f95428c72ec436b96ba17bbcfea0  # v0.45.0
      dockerfile: test-plans/HolePunchDockerfile
    transports: [tcp, quic-v1]
    secureChannels: [noise, tls]
    muxers: [yamux]

  # js-libp2p v3.x — Circuit Relay v2 + DCUtR (TCP only for initial iteration)
  - id: js-v3.x
    source:
      type: local
      path: images/js/v3.x
      dockerfile: Dockerfile.relay
    transports: [tcp]
    secureChannels: [noise]
    muxers: [yamux]

# Implementation definitions
implementations:
  - id: rust-v0.56
    source:
      type: local
      path: images/rust/v0.56
      dockerfile: Dockerfile.peer
    transports: [quic-v1, tcp, webrtc-direct, ws]
    secureChannels: [noise, tls]
    muxers: [yamux, mplex]

  # go-libp2p v0.45 — robust, mature DCUtR implementation (see docs/overall-flow.md)
  - id: go-v0.45
    source:
      type: github
      repo: libp2p/go-libp2p
      commit: d0ecbf99a977f95428c72ec436b96ba17bbcfea0  # v0.45.0
      dockerfile: test-plans/HolePunchDockerfile
    transports: [tcp, quic-v1]
    secureChannels: [noise, tls]
    muxers: [yamux]

  # js-libp2p v3.x — DCUtR + Circuit Relay v2 (TCP only for initial iteration)
  - id: js-v3.x
    source:
      type: local
      path: images/js/v3.x
      dockerfile: Dockerfile.peer
    transports: [tcp]
    secureChannels: [noise]
    muxers: [yamux]
